<?xml version="1.0" encoding="UTF-8" ?>
<odoo>
    <data>
        <template id="course_sidebar_inherit" inherit_id="website_slides.course_sidebar">
            <!-- to replace label Responsible to SPM -->
            <xpath expr="//tr[@t-if='channel.user_id']/th" position="replace">
                <th class="border-top-0">SPM</th>
            </xpath>

            <!-- to add necessary information of the course -->
            <xpath expr="//div[@id='o_wslides_sidebar_collapse']/table/tr[2]" position="after">
                <tr t-if="channel.teacher_id">
                    <th class="border-top-0">Teacher</th>
                    <td class="border-top-0 text-break"><span t-esc="channel.teacher_id.name"/></td>
                </tr>
                <tr t-if="channel.term_id">
                    <th class="border-top-0">Term</th>
                    <td class="border-top-0 text-break"><span t-esc="channel.term_id.name"/></td>
                </tr>
                <tr t-if="channel.school_year_id">
                    <th class="border-top-0">School Year</th>
                    <td class="border-top-0 text-break"><span t-esc="channel.school_year_id.name"/></td>
                </tr>
                <tr t-if="channel.start_date">
                    <th class="border-top-0">Start Date</th>
                    <td class="border-top-0 text-break"><span t-esc="channel.start_date" t-options="{'widget': 'date'}"/></td>
                </tr>
                <tr t-if="channel.end_date">
                    <th class="border-top-0">End Date</th>
                    <td class="border-top-0 text-break"><span t-esc="channel.end_date" t-options="{'widget': 'date'}"/></td>
                </tr>
            </xpath>

            <!-- to remove the Last Updated column  -->
            <xpath expr="//div[@id='o_wslides_sidebar_collapse']/table/tr[2]" position="replace"/>
        </template>

         <template id="course_main_inherit" inherit_id="website_slides.course_main">
             <!-- to add new tab called Sessions  -->
             <xpath expr="//div[@class='o_wslides_course_main']/div/div/div[2]/ul/li[1]" position="after">
                 <li class="nav-item" role="presentation">
                    <a t-att-class="'nav-link %s' % ('active' if active_tab == 'sessions' else '')"
                        id="sessions-tab" data-bs-toggle="pill" href="#sessions" role="tab" aria-controls="sessions"
                        t-att-aria-selected="'true' if active_tab == 'sessions' else 'false'">Sessions</a>
                </li>
             </xpath>

             <!-- to design the template of Sessions  -->
             <xpath expr="//div[hasclass('tab-content')]" position="inside">
                 <div t-att-class="'tab-pane fade %s' % ('show active' if active_tab == 'sessions' else '')" id="sessions" role="tabpanel" aria-labelledby="sessions-tab">
                    <div t-if="channel.session_ids">
                        <div class="">
                            <a t-att-href="channel.external_link" target="_blank" class="btn btn-primary w-100 mb-3" role="button" aria-pressed="true">Class link</a>
                        </div>
                        <div class="sessions-grid">
                            <!-- Set to track unique session types -->
                            <t t-set="unique_types" t-value="set()"/>

                            <!-- Loop through session_ids and group by type -->
                            <t t-foreach="channel.session_ids" t-as="session">
                                <!-- Create a unique key based on the session type -->
                                <t t-set="type_key" t-value="session.type"/>

                                <!-- Only display if type hasn't been displayed yet -->
                                <t t-if="type_key not in unique_types">
                                    <div class="session-card">
                                        <!-- Add the type to the set of displayed types -->
                                        <t t-set="unique_types" t-value="unique_types | {type_key}"/>

                                        <!-- Session title (name/type) -->
                                        <h3><strong t-esc="session.type"/></h3>

                                        <!-- Display start and stop time (as a range, only time) -->
                                        <p>
                                            <t t-esc="request.env['ir.qweb.field.datetime'].value_to_html(session.start_datetime, {'widget': 'time_only', 'time_only': True}).split(':')[0] + ':' + request.env['ir.qweb.field.datetime'].value_to_html(session.start_datetime, {'widget': 'time_only', 'time_only': True}).split(':')[1]"/>
                                            &#x2192;
                                            <t t-esc="request.env['ir.qweb.field.datetime'].value_to_html(session.end_datetime, {'widget': 'time_only', 'time_only': True}).split(':')[0] + ':' + request.env['ir.qweb.field.datetime'].value_to_html(session.end_datetime, {'widget': 'time_only', 'time_only': True}).split(':')[1]"/>
                                        </p>
                                    </div>
                                </t>
                            </t>
                        </div>
                    </div>
                    <div t-if="not channel.session_ids">
                        <p>No sessions available for this course.</p>
                    </div>
                </div>
             </xpath>
         </template>
    </data>
</odoo>